<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulacro de Consultas - Tarjetón Interactivo</title>
<style>
  :root {
    --spot-color: rgba(0, 128, 255, 0.18);
    --spot-border: rgba(0, 128, 255, 0.9);
    --ok: #0a7f2e;
    --warn: #b76b00;
    --error: #b00020;
    --grid: rgba(255,255,255,.08);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: #111827; color: #e5e7eb;
    display: grid; place-items: start center; padding: 16px; gap: 16px;
  }
  header, .card { width: min(900px, 100%); }
  .card {
    background: #0b1220; border: 1px solid #1f2937; border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35); padding: 14px;
  }
  .ballot {
    position: relative; width: 100%;
    aspect-ratio: 872 / 1112; /* <-- PROPORCIÓN REAL */
    background: #0a0f1c; border-radius: 10px; overflow: hidden; border: 1px solid #1f2937;
  }
  .ballot img.base {
    position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain;
    z-index: 1; user-select: none; -webkit-user-drag: none; pointer-events: none;
  }

  /* Rejilla de apoyo (toggle con G) */
  .grid {
    position: absolute; inset: 0; z-index: 2; pointer-events: none; display: none;
    background-image:
      linear-gradient(to right, var(--grid) 1px, transparent 1px),
      linear-gradient(to bottom, var(--grid) 1px, transparent 1px);
    background-size: calc(100%/6) 100%, 100% calc(100%/8); /* 6 columnas, 8 filas aprox */
  }
  .grid.on { display: block; }

  /* Marcador X (usa tu X.png) */
  #markX {
    position: absolute; z-index: 3; display: none; pointer-events: none;
  }
  #markX img {
    position: absolute; inset: 8% 8% 8% 8%;
    width: 84%; height: 84%; object-fit: contain;
    filter: drop-shadow(0 2px 2px rgba(0,0,0,.35));
    opacity: 0.98; pointer-events: none;
  }

  /* Zonas clicables */
  .hotspot {
    position: absolute; z-index: 4; cursor: pointer; background: transparent; border: none; outline: none;
  }
  .hotspot.help::after {
    content: attr(data-label);
    position: absolute; inset: 0;
    border: 2px dashed var(--spot-border);
    background: var(--spot-color);
    color: #fff; font-weight: 600; font-size: 12px;
    display: grid; place-items: center; text-shadow: 0 1px 2px #000;
    border-radius: 6px;
  }

  .status { margin-top: 10px; font-size: 14px; min-height: 22px; }
  .status.ok { color: var(--ok); }
  .status.warn { color: var(--warn); }
  .status.error { color: var(--error); }

  details.summary-card { margin-top: 14px; border-top: 1px dashed #1f2937; padding-top: 12px; }
  details > summary { cursor: pointer; list-style: none; font-weight: 700; }
  details > summary::-webkit-details-marker { display: none; }
</style>
</head>
<body>
  <header>
    <h1>Simulacro de Consultas</h1>
    <p>Haz clic en una casilla: se marcará con tu “X” y quedará el registro en Sheets. Teclas: <b>H</b> (modo ayuda) y <b>G</b> (rejilla).</p>
  </header>

  <section class="card">
    <div id="ballot" class="ballot" aria-label="Tarjetón interactivo">
      <!-- Imagen base (872×1112) -->
      <img class="base" src="Consultas.png" alt="Tarjetón" />

      <!-- Rejilla de apoyo -->
      <div id="grid" class="grid" aria-hidden="true"></div>

      <!-- Marcador global (X.png) que se reposiciona -->
      <div id="markX" aria-hidden="true">
        <img src="X.png" alt="" />
      </div>
      <!-- Hotspots se crean por JS -->
    </div>

    <div id="status" class="status" role="status" aria-live="polite"></div>

    <!-- Información pedagógica -->
    <details class="summary-card" open>
      <summary>Información pedagógica</summary>
      <ul>
        <li><strong>Marca una sola opción en esta tarjeta.</strong> Este simulador es de uso educativo.</li>
        <li>El objetivo es practicar la ubicación de casillas y cómo seleccionar correctamente.</li>
        <li>Este simulador no es un sistema oficial de votación; sus resultados no son vinculantes.</li>
        <li>Privacidad: no se recopilan datos personales; se guarda la opción elegida y metadatos técnicos mínimos para el conteo pedagógico.</li>
      </ul>
    </details>
  </section>

<script>
/** ==============================
 * CONFIGURACIÓN
 * ============================== */
const WEBAPP_URL =
  'https://script.google.com/macros/s/AKfycbyJzMK97YU8JDd8W7X9ZyQei3tCuz4u327WKLvmqjtVSvET4f_LwOOSCn5_FyZ_o7hb/exec';

let HELP_MODE = false;
let GRID_MODE = false;

/* Zonas clicables (porcentajes relativos al contenedor).
   ⚠️ Estas son aproximadas para el layout vertical; ajústalas con H/G. */
const AREAS = [
  /* ——— Sección superior (“Consulta de las soluciones”) ——— */
  { id: 'sol-1', label: 'Opción 1', top: 8, left: 8,  width: 36, height: 14 },
  { id: 'sol-2', label: 'Opción 2', top: 8, left: 56, width: 36, height: 14 },

  /* ——— Bloque medio (“La gran consulta por Colombia”) ——— */
  /* Fila 1 (6 casillas aprox) */
  { id: 'gran-1', label: 'Opción 3',  top: 28, left: 6,  width: 14, height: 13 },
  { id: 'gran-2', label: 'Opción 4',  top: 28, left: 22, width: 14, height: 13 },
  { id: 'gran-3', label: 'Opción 5',  top: 28, left: 38, width: 14, height: 13 },
  { id: 'gran-4', label: 'Opción 6',  top: 28, left: 54, width: 14, height: 13 },
  { id: 'gran-5', label: 'Opción 7',  top: 28, left: 70, width: 14, height: 13 },
  { id: 'gran-6', label: 'Opción 8',  top: 28, left: 86, width: 8,  height: 28 }, /* columna lateral alta (si aplica) */

  /* Fila 2 (5 casillas) */
  { id: 'gran-7',  label: 'Opción 9',  top: 44, left: 6,  width: 14, height: 13 },
  { id: 'gran-8',  label: 'Opción 10', top: 44, left: 22, width: 14, height: 13 },
  { id: 'gran-9',  label: 'Opción 11', top: 44, left: 38, width: 14, height: 13 },
  { id: 'gran-10', label: 'Opción 12', top: 44, left: 54, width: 14, height: 13 },
  { id: 'gran-11', label: 'Opción 13', top: 44, left: 70, width: 14, height: 13 },

  /* ——— Parte inferior (“Frente por la vida”) ——— */
  { id: 'vida-1', label: 'Opción 14', top: 66, left: 8,  width: 16, height: 18 },
  { id: 'vida-2', label: 'Opción 15', top: 66, left: 28, width: 16, height: 18 },
  { id: 'vida-3', label: 'Opción 16', top: 66, left: 48, width: 16, height: 18 },
  { id: 'vida-4', label: 'Opción 17', top: 66, left: 68, width: 16, height: 18 },
  { id: 'vida-5', label: 'Opción 18', top: 66, left: 86, width: 10, height: 18 },
];

/* ===============================
   LÓGICA
   =============================== */
const ballotEl = document.getElementById('ballot');
const statusEl = document.getElementById('status');
const markX = document.getElementById('markX');
const gridEl = document.getElementById('grid');

function pct(v){ return v + '%'; }

/* Renderiza hotspots y restaura selección */
function drawSpots() {
  // Limpia anteriores
  Array.from(ballotEl.querySelectorAll('.hotspot')).forEach(el => el.remove());

  // Crea botones clicables
  for (const a of AREAS) {
    const btn = document.createElement('button');
    btn.className = 'hotspot' + (HELP_MODE ? ' help' : '');
    btn.style.top = pct(a.top);
    btn.style.left = pct(a.left);
    btn.style.width = pct(a.width);
    btn.style.height = pct(a.height);
    btn.setAttribute('aria-label', a.label);
    btn.setAttribute('data-label', a.label);
    btn.title = a.label;
    btn.addEventListener('click', () => handleSelect(a));
    ballotEl.appendChild(btn);
  }

  const savedId = sessionStorage.getItem('selectedAreaId');
  if (savedId) {
    const prev = AREAS.find(x => x.id === savedId);
    if (prev) positionX(prev);
  }
}

/* Posiciona la X dentro de la casilla seleccionada */
function positionX(area) {
  markX.style.display = 'block';
  markX.style.top = pct(area.top);
  markX.style.left = pct(area.left);
  markX.style.width = pct(area.width);
  markX.style.height = pct(area.height);
}

/* Envío al WebApp + feedback */
async function handleSelect(area) {
  positionX(area);
  sessionStorage.setItem('selectedAreaId', area.id);

  const payload = {
    optionId: area.id,
    label: area.label,
    userAgent: navigator.userAgent,
    tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
  };

  showStatus(`Registrando selección: ${area.label}…`, 'warn');

  try {
    const res = await fetch(WEBAPP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    let ok = false;
    try { ok = !!(await res.json()).ok; }
    catch (_) { ok = res.ok || res.status === 0; }

    showStatus(ok ? `✅ ¡Voto registrado! (${area.label})`
                  : 'No se pudo confirmar el registro. Intenta de nuevo.',
               ok ? 'ok' : 'error');
  } catch (err) {
    console.error(err);
    showStatus('Error de red. Revisa tu conexión e inténtalo nuevamente.', 'error');
  }
}

function showStatus(msg, kind) {
  statusEl.textContent = msg;
  statusEl.className = 'status ' + (kind || '');
}

/* Atajos: H = ayuda (contornos), G = rejilla */
document.addEventListener('keydown', (e) => {
  const k = e.key.toLowerCase();
  if (k === 'h') {
    HELP_MODE = !HELP_MODE;
    drawSpots();
    showStatus(HELP_MODE ? 'Modo ayuda ON (bordes visibles)' : 'Modo ayuda OFF', 'warn');
  }
  if (k === 'g') {
    GRID_MODE = !GRID_MODE;
    gridEl.classList.toggle('on', GRID_MODE);
    showStatus(GRID_MODE ? 'Rejilla ON' : 'Rejilla OFF', 'warn');
  }
});

// Inicializa
drawSpots();
showStatus('Listo. Ajusta zonas con H y G si hace falta.', 'warn');
</script>
</body>
</html>
