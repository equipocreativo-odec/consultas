<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulacro de Consultas - Tarjetón Interactivo</title>
<style>
  :root {
    --spot-color: rgba(0, 128, 255, 0.18);
    --spot-border: rgba(0, 128, 255, 0.9);
    --ok: #0a7f2e;
    --warn: #b76b00;
    --error: #b00020;
    --bg: #0f172a;
    --fg: #e5e7eb;
  }
  body {
    margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: #111827; color: var(--fg);
    display: grid; place-items: start center; padding: 16px;
  }
  header { width: min(1100px, 100%); margin-bottom: 12px; }
  .card {
    width: min(1100px, 100%);
    background: #0b1220; border: 1px solid #1f2937; border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35); padding: 14px;
  }
  .ballot {
    position: relative; width: 100%;
    aspect-ratio: 678 / 531; /* ajusta si tu imagen no es 678x531 */
    background: #0a0f1c; border-radius: 10px; overflow: hidden; border: 1px solid #1f2937;
  }
  .ballot img {
    position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain;
    user-select: none; -webkit-user-drag: none; pointer-events: none;
  }
  .hotspot {
    position: absolute; cursor: pointer; outline: none; border: none; background: transparent;
  }
  /* Modo ayuda: muestra el rectángulo de cada hotspot */
  .hotspot.help::after {
    content: attr(data-label);
    position: absolute; inset: 0;
    border: 2px dashed var(--spot-border);
    background: var(--spot-color);
    color: #fff; font-weight: 600; font-size: 12px;
    display: grid; place-items: center; text-shadow: 0 1px 2px #000;
    border-radius: 6px;
  }
  .legend {
    display: flex; gap: 8px; align-items: center; font-size: 14px; color: #cbd5e1;
  }
  .pill { padding: 4px 10px; border-radius: 999px; background: #111827; border: 1px solid #1f2937; }
  .status { margin-top: 10px; font-size: 14px; min-height: 22px; }
  .status.ok { color: var(--ok); }
  .status.warn { color: var(--warn); }
  .status.error { color: var(--error); }
  .footer { font-size: 12px; color: #9ca3af; margin-top: 8px; }
  code.kbd {
    background: #111827; border: 1px solid #1f2937; border-radius: 6px; padding: 0 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }
</style>
</head>
<body>
  <header>
    <h1>Simulacro de Consultas</h1>
    <div class="legend">
      <span class="pill">Haz clic en una casilla para registrar tu selección</span>
      <span class="pill">Tecla <code class="kbd">H</code> → alterna modo ayuda</span>
    </div>
  </header>

  <section class="card">
    <div id="ballot" class="ballot" aria-label="Tarjetón interactivo">
      <img src="Consultas.png" alt="Tarjetón de consultas" />
      <!-- Los hotspots se inyectan por JS -->
    </div>
    <div id="status" class="status" role="status" aria-live="polite"></div>
    <div class="footer">Este es un ejercicio pedagógico. No recoge datos personales.</div>
  </section>

<script>
/** ==============================
 * CONFIGURA AQUÍ
 * ============================== */
const WEBAPP_URL = 'PON_AQUI_LA_URL_DEL_WEBAPP'; // pega la URL de tu implementación de Apps Script

// Alterna el modo ayuda con la tecla H (muestra rectángulos visibles para ajustar zonas)
let HELP_MODE = false;

// Define las zonas clicables (en porcentajes relativos al contenedor)
// Ajusta top/left/width/height para calzar con tu imagen.
const AREAS = [
  /** ——— Fila 1: "Consulta de las soluciones" (2 opciones) ——— */
  { id: 'sol-1', label: 'Opción 1', top: 5, left: 5,  width: 35, height: 18 },
  { id: 'sol-2', label: 'Opción 2', top: 5, left: 60, width: 35, height: 18 },

  /** ——— Bloque central: "La gran consulta por Colombia"
      Nota: Ajusta según veas el calce. Hecho con filas de ~18% alto cada una. ——— */
  // Fila superior del bloque central (5 casillas aprox + 1 a la derecha)
  { id: 'gran-1', label: 'Opción 3',  top: 28, left: 3,  width: 14, height: 18 },
  { id: 'gran-2', label: 'Opción 4',  top: 28, left: 19, width: 14, height: 18 },
  { id: 'gran-3', label: 'Opción 5',  top: 28, left: 35, width: 14, height: 18 },
  { id: 'gran-4', label: 'Opción 6',  top: 28, left: 51, width: 14, height: 18 },
  { id: 'gran-5', label: 'Opción 7',  top: 28, left: 67, width: 14, height: 18 },
  { id: 'gran-6', label: 'Opción 8',  top: 28, left: 83, width: 14, height: 18 }, // la columna derecha alta

  // Fila inferior del bloque central (5 casillas aprox)
  { id: 'gran-7',  label: 'Opción 9',  top: 48, left: 3,  width: 14, height: 18 },
  { id: 'gran-8',  label: 'Opción 10', top: 48, left: 19, width: 14, height: 18 },
  { id: 'gran-9',  label: 'Opción 11', top: 48, left: 35, width: 14, height: 18 },
  { id: 'gran-10', label: 'Opción 12', top: 48, left: 51, width: 14, height: 18 },
  { id: 'gran-11', label: 'Opción 13', top: 48, left: 67, width: 14, height: 18 },

  /** ——— Bloque inferior: "Frente por la vida" (5 opciones aprox) ——— */
  { id: 'vida-1', label: 'Opción 14', top: 72, left: 5,  width: 17, height: 22 },
  { id: 'vida-2', label: 'Opción 15', top: 72, left: 24, width: 17, height: 22 },
  { id: 'vida-3', label: 'Opción 16', top: 72, left: 43, width: 17, height: 22 },
  { id: 'vida-4', label: 'Opción 17', top: 72, left: 62, width: 17, height: 22 },
  { id: 'vida-5', label: 'Opción 18', top: 72, left: 81, width: 14, height: 22 },
];

// ===============================
// LÓGICA: render hotspots + envío
// ===============================
const ballotEl = document.getElementById('ballot');
const statusEl = document.getElementById('status');

/** Crea un botón transparente por cada área **/
function drawSpots() {
  // Limpia spots previos
  Array.from(ballotEl.querySelectorAll('.hotspot')).forEach(el => el.remove());
  // Crea spots
  for (const a of AREAS) {
    const btn = document.createElement('button');
    btn.className = 'hotspot' + (HELP_MODE ? ' help' : '');
    btn.style.top = a.top + '%';
    btn.style.left = a.left + '%';
    btn.style.width = a.width + '%';
    btn.style.height = a.height + '%';
    btn.setAttribute('aria-label', a.label);
    btn.setAttribute('data-label', a.label);
    btn.title = a.label;

    btn.addEventListener('click', () => castVote(a));
    ballotEl.appendChild(btn);
  }
}

async function castVote(area) {
  // Prepara payload
  const payload = {
    optionId: area.id,
    label: area.label,
    userAgent: navigator.userAgent,
    tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
  };

  // Muestra estado
  showStatus(`Registrando selección: ${area.label}…`, 'warn');

  try {
    // En algunos despliegues podría requerirse { mode: 'no-cors' } si hay CORS.
    const res = await fetch(WEBAPP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    // Si el WebApp permite leer respuesta, intenta parsear:
    let ok = false;
    try {
      const data = await res.json();
      ok = !!data.ok;
    } catch (_) {
      // Si no se puede leer (p.ej. por no-cors), asumimos éxito si no falló la petición.
      ok = res.ok || res.status === 0;
    }

    if (ok) {
      showStatus(`✅ ¡Voto registrado! (${area.label})`, 'ok');
    } else {
      showStatus('No se pudo confirmar el registro. Intenta de nuevo.', 'error');
    }
  } catch (err) {
    console.error(err);
    showStatus('Error de red. Revisa tu conexión e inténtalo nuevamente.', 'error');
  }
}

function showStatus(msg, kind) {
  statusEl.textContent = msg;
  statusEl.className = 'status ' + (kind || '');
}

document.addEventListener('keydown', (e) => {
  if (e.key.toLowerCase() === 'h') {
    HELP_MODE = !HELP_MODE;
    drawSpots();
    showStatus(HELP_MODE ? 'Modo ayuda ON (bordes visibles)' : 'Modo ayuda OFF', 'warn');
  }
});

// Inicializa
drawSpots();
showStatus('Listo. Presiona la tecla "H" para ajustar zonas si hace falta.', 'warn');
</script>
</body>
</html>
