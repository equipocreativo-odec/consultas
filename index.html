<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tarjetón por Consultas – Selección única + Google Sheets</title>
<style>
  :root {
    --bg:#f7f7f8; --card:#fff; --border:#e5e7eb;
    --text:#111827; --muted:#6b7280; --accent:#0b5fff; --x:#d32f2f;
    --radius:12px;
    --gap:14px;
    --logo-h:56px;   /* altura del área del logo en móvil */
    --logo-pad:6px;  /* padding interno del logo */
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans';background:var(--bg);color:var(--text)}
  header{padding:18px 16px;background:var(--card);border-bottom:1px solid var(--border)}
  h1{margin:.2rem 0 0;font-size:1.5rem}
  .sub{color:var(--muted);margin:.3rem 0 0}
  .container{max-width:1200px;margin:0 auto;padding:16px}
  .notice{background:#fff6e5;border:1px solid #f5d7a1;color:#7a5a1b;padding:10px 12px;border-radius:8px;margin:10px 0 18px}

  /* === Grillas responsivas === */
  .consulta{margin:22px 0}
  .consulta h2{font-size:1.05rem;margin:0 0 6px}
  .consulta .subtitle{color:var(--muted);margin:0 0 10px}
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
    gap:var(--gap);
  }

  /* === Tarjeta === */
  .tile{
    position:relative;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
    padding:12px;display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer;
    transition:box-shadow .15s ease, transform .06s ease;
  }
  .tile:hover{box-shadow:0 6px 18px rgba(0,0,0,.06);transform:translateY(-1px)}
  .tile[role=radio]{outline:none}
  .tile[aria-checked=true]{box-shadow:0 0 0 3px rgba(11,95,255,.15)}

  /* Foto con proporción 3:4 (vertical) */
  .photo{
    width:100%;
    aspect-ratio:3/4;
    object-fit:cover;
    border-radius:10px;
    border:1px solid var(--border);
    background:#fafafa;
  }

  /* Logo centrado en banda de altura fija */
  .logo-wrap{width:100%}
  .logo{
    width:100%;
    height:var(--logo-h);
    object-fit:contain;          /* que no se distorsione */
    object-position:center;
    background:#fff;
    border:1px solid var(--border);
    border-radius:8px;
    padding:var(--logo-pad);
  }

  .name{
    font-weight:700;text-align:center;line-height:1.2;
    display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden;
    min-height:2.4em; /* asegura 2 líneas */
  }

  /* X superpuesta */
  .xmark{
    position:absolute;inset:0;display:grid;place-items:center;pointer-events:none;
    font-weight:900;font-size:86px;color:var(--x);opacity:0;transition:opacity .12s ease
  }
  .tile.selected .xmark{opacity:.9}

  .resume{margin-top:12px;color:var(--muted)}

  /* ======= Breakpoints ======= */
  /* Teléfonos: 2 columnas, compacidad y X más pequeña */
  @media (max-width: 480px){
    .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px; }
    .tile{ padding:10px; border-radius:10px; }
    .photo{ border-radius:8px; }
    .logo{ height:52px; padding:5px; }
    .name{ font-size:.82rem; }
    .xmark{ font-size:58px; }
  }

  /* Tablets chicas: 3 columnas */
  @media (min-width: 481px) and (max-width: 768px){
    .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    .logo{ height:58px; }
  }

  /* Desktop: auto-fill de 240px (definido arriba) */
</style>
</head>
<body>
<header>
  <h1>Tarjetón por consultas</h1>
  <p class="sub">Regla de voto válido: <strong>una sola marca</strong> en todo el tarjetón.</p>
</header>

<div class="container">
  <div class="notice">Recurso educativo. Al seleccionar, se envía automáticamente el registro al sistema.</div>
  <div id="content"></div>
  <div class="resume">Candidato marcado: <span id="resumen">—</span></div>
</div>

<script>
  /* ====== Datos (candidatos + consultas) ====== */
  const DATA = {
    "records": [
      {"name":"Claudia Nayibe López Hernández","slug":"claudia-nayibe-lopez-hernandez","photo":"assets/photo-claudia-nayibe-lopez-hernandez.png","logo":"assets/logo-claudia-nayibe-lopez-hernandez.png"},
      {"name":"Leonardo Humberto Huerta Gutiérrez","slug":"leonardo-humberto-huerta-gutierrez","photo":"assets/photo-leonardo-humberto-huerta-gutierrez.png","logo":"assets/logo-leonardo-humberto-huerta-gutierrez.png"},
      {"name":"Mauricio Cárdenas Santamaría","slug":"mauricio-cardenas-santamaria","photo":"assets/photo-mauricio-cardenas-santamaria.png","logo":"assets/logo-mauricio-cardenas-santamaria.png"},
      {"name":"David Andrés Luna Sánchez","slug":"david-andres-luna-sanchez","photo":"assets/photo-david-andres-luna-sanchez.png","logo":"assets/logo-david-andres-luna-sanchez.png"},
      {"name":"Victoria Eugenia Dávila Hoyos","slug":"victoria-eugenia-davila-hoyos","photo":"assets/photo-victoria-eugenia-davila-hoyos.png","logo":"assets/logo-victoria-eugenia-davila-hoyos.png"},
      {"name":"Juan Manuel Galán Pachón","slug":"juan-manuel-galan-pachon","photo":"assets/photo-juan-manuel-galan-pachon.png","logo":"assets/logo-juan-manuel-galan-pachon.png"},
      {"name":"Paloma Susana Valencia Laserna","slug":"paloma-susana-valencia-laserna","photo":"assets/photo-paloma-susana-valencia-laserna.png","logo":"assets/logo-paloma-susana-valencia-laserna.png"},
      {"name":"Juan Carlos Pinzón Bueno","slug":"juan-carlos-pinzon-bueno","photo":"assets/photo-juan-carlos-pinzon-bueno.png","logo":"assets/logo-juan-carlos-pinzon-bueno.png"},
      {"name":"Aníbal Gaviria Correa","slug":"anibal-gaviria-correa","photo":"assets/photo-anibal-gaviria-correa.png","logo":"assets/logo-anibal-gaviria-correa.png"},
      {"name":"Enrique Peñalosa Londoño","slug":"enrique-penalosa-londono","photo":"assets/photo-enrique-penalosa-londono.png","logo":"assets/logo-enrique-penalosa-londono.png"},
      {"name":"Juan Daniel Oviedo Arango","slug":"juan-daniel-oviedo-arango","photo":"assets/photo-juan-daniel-oviedo-arango.png","logo":"assets/logo-juan-daniel-oviedo-arango.png"},
      {"name":"Héctor Elías Pineda Salazar","slug":"hector-elias-pineda-salazar","photo":"assets/photo-hector-elias-pineda-salazar.png","logo":"assets/logo-hector-elias-pineda-salazar.png"},
      {"name":"Edison Lucio Torres Moreno","slug":"edison-lucio-torres-moreno","photo":"assets/photo-edison-lucio-torres-moreno.png","logo":"assets/logo-edison-lucio-torres-moreno.png"},
      {"name":"Roy Leonardo Barreras Montealegre","slug":"roy-leonardo-barreras-montealegre","photo":"assets/photo-roy-leonardo-barreras-montealegre.png","logo":"assets/logo-roy-leonardo-barreras-montealegre.png"},
      {"name":"Martha Viviana Bernal Amaya","slug":"martha-viviana-bernal-amaya","photo":"assets/photo-martha-viviana-bernal-amaya.png","logo":"assets/logo-martha-viviana-bernal-amaya.png"},
      {"name":"Daniel Quintero Calle","slug":"daniel-quintero-calle","photo":"assets/photo-daniel-quintero-calle.png","logo":"assets/logo-daniel-quintero-calle.png"}
    ],
    "consultas": [
      {
        "title": "Consulta de las Soluciones",
        "subtitle": "Salud, seguridad y educación",
        "candidates": [
          "claudia-nayibe-lopez-hernandez",
          "leonardo-humberto-huerta-gutierrez"
        ]
      },
      {
        "title": "La Gran Consulta por Colombia",
        "subtitle": "",
        "candidates": [
          "mauricio-cardenas-santamaria",
          "david-andres-luna-sanchez",
          "victoria-eugenia-davila-hoyos",
          "juan-manuel-galan-pachon",
          "paloma-susana-valencia-laserna",
          "juan-carlos-pinzon-bueno",
          "anibal-gaviria-correa",
          "enrique-penalosa-londono",
          "juan-daniel-oviedo-arango"
        ]
      },
      {
        "title": "Consulta del Frente por la Vida",
        "subtitle": "",
        "candidates": [
          "hector-elias-pineda-salazar",
          "edison-lucio-torres-moreno",
          "roy-leonardo-barreras-montealegre",
          "martha-viviana-bernal-amaya",
          "daniel-quintero-calle"
        ]
      }
    ]
  };

  /* ====== Render ====== */
  const bySlug = Object.fromEntries(DATA.records.map(r => [r.slug, r]));
  const content = document.getElementById('content');
  const resumen = document.getElementById('resumen');

  function render(){
    content.innerHTML = '';
    DATA.consultas.forEach((g, gidx) => {
      const sec = document.createElement('section');
      sec.className = 'consulta';
      const h = document.createElement('h2'); h.textContent = g.title; sec.appendChild(h);
      if (g.subtitle){ const p = document.createElement('p'); p.className = 'subtitle'; p.textContent = g.subtitle; sec.appendChild(p); }
      const grid = document.createElement('div'); grid.className = 'grid';

      g.candidates.forEach((slug, idx) => {
        const c = bySlug[slug]; if(!c) return;
        const tile = document.createElement('div');
        tile.className = 'tile'; tile.setAttribute('role','radio'); tile.setAttribute('aria-checked','false');
        tile.setAttribute('tabindex', (gidx===0 && idx===0) ? '0':'-1'); tile.dataset.slug = slug;
        tile.innerHTML = `
          <img class="photo" src="${c.photo}" alt="Foto de ${c.name}" loading="lazy">
          <div class="logo-wrap">
            <img class="logo" src="${c.logo}" alt="Logo de ${c.name}" loading="lazy">
          </div>
          <div class="name">${c.name}</div>
          <div class="xmark">X</div>`;

        tile.addEventListener('click', () => selectBySlug(slug));
        tile.addEventListener('keydown', (e) => {
          const tiles = [...sec.querySelectorAll('.tile')];
          const i = tiles.indexOf(tile); const max = tiles.length - 1;
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selectBySlug(slug); }
          else if (e.key === 'ArrowRight' || e.key === 'ArrowDown') { e.preventDefault(); focusTile(tiles[Math.min(max, i+1)]); }
          else if (e.key === 'ArrowLeft'  || e.key === 'ArrowUp')   { e.preventDefault(); focusTile(tiles[Math.max(0, i-1)]); }
        });

        grid.appendChild(tile);
      });

      sec.appendChild(grid); content.appendChild(sec);
    });
  }

  function focusTile(el){
    if(!el) return; document.querySelectorAll('.tile').forEach(t=>t.setAttribute('tabindex','-1'));
    el.setAttribute('tabindex','0'); el.focus();
  }

  /* ====== Integración con Google Sheets (auto) ====== */
  const GOOGLE_SHEET_API = "https://script.google.com/macros/s/AKfycbzrcOa_YqUlAyU9ECe99Bosk_VQttAOmB5l3oLy2dmeL0Cg9gTiHd133pxn0qsKd-MvJA/exec";
  let lastSent = null;
  async function registrarVotoAutomatico(nombreCandidato){
    if(!nombreCandidato) return;
    if(lastSent === nombreCandidato) { /* evitar duplicados inmediatos */ }
    try{
      await fetch(GOOGLE_SHEET_API, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ candidato: nombreCandidato })
      });
      lastSent = nombreCandidato;
      console.log('Voto enviado a Google Sheets:', nombreCandidato);
    }catch(err){
      console.warn('No se pudo enviar el voto a Google Sheets en este momento.');
    }
  }

  /* ====== Selección única + envío automático ====== */
  function selectBySlug(slug){
    document.querySelectorAll('.tile').forEach(t=>{ t.classList.remove('selected'); t.setAttribute('aria-checked','false'); });
    const chosen = document.querySelector(`.tile[data-slug="${slug}"]`);
    if(chosen){ chosen.classList.add('selected'); chosen.setAttribute('aria-checked','true'); }
    const rec = bySlug[slug];
    const name = rec ? rec.name : null;
    resumen.textContent = name || '—';
    registrarVotoAutomatico(name);
  }

  render();
</script>
</body>
</html>
